---
layout: null
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Estate Agency Models — RealEasy Data Architecture</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#0f1117;color:#e0e0e0;line-height:1.6}
.header{background:linear-gradient(135deg,#1a1f36,#0d1025);padding:32px 40px;border-bottom:1px solid #2a2f45}
.header h1{font-size:24px;font-weight:700;background:linear-gradient(135deg,#60a5fa,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header p{color:#8892b0;font-size:14px;margin-top:4px}
.container{max-width:1400px;margin:0 auto;padding:24px}
.section-title{font-size:18px;font-weight:600;margin:32px 0 16px;color:#c8cee0;display:flex;align-items:center;gap:10px}
.section-title .num{background:linear-gradient(135deg,#60a5fa,#a78bfa);color:#0f1117;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0}

/* Tabs */
.tabs{display:flex;gap:4px;margin-bottom:20px;background:#1a1f36;border-radius:10px;padding:4px}
.tab{padding:10px 20px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;color:#8892b0;transition:all .2s}
.tab:hover{color:#c8cee0}
.tab.active{background:#2a2f45;color:#60a5fa}
.tab-content{display:none}
.tab-content.active{display:block}

/* Model Cards */
.model-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
@media(max-width:1000px){.model-grid{grid-template-columns:1fr}}
.model-card{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;transition:border-color .2s}
.model-card:hover{border-color:#60a5fa33}
.model-card .badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px}
.model-card h3{font-size:16px;font-weight:600;color:#e0e0e0;margin-bottom:8px}
.model-card .desc{font-size:13px;color:#8892b0;margin-bottom:16px}
.model-card .example{background:#0f1117;border-radius:8px;padding:14px;margin-bottom:12px}
.model-card .example-label{font-size:11px;color:#60a5fa;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;font-weight:600}
.model-card .example-name{font-size:14px;font-weight:600;color:#c8cee0}
.model-card .example-detail{font-size:12px;color:#8892b0;margin-top:4px}
.model-card .trait{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;font-size:13px;color:#a0a8c0}
.model-card .trait svg{width:16px;height:16px;flex-shrink:0;margin-top:2px}

/* Network Graph */
.graph-container{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;overflow:hidden;position:relative}
.graph-container svg{width:100%;display:block}
.graph-legend{position:absolute;top:16px;left:16px;background:#0f1117dd;border-radius:8px;padding:12px 16px;font-size:12px}
.graph-legend .item{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.graph-legend .item:last-child{margin-bottom:0}
.graph-legend .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.graph-title{position:absolute;top:16px;right:16px;background:#0f1117dd;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:600;color:#a78bfa}

/* Agent Overlap Table */
.overlap-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:800px){.overlap-grid{grid-template-columns:1fr}}
.overlap-card{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:20px}
.overlap-card h3{font-size:15px;font-weight:600;margin-bottom:4px}
.overlap-card .subtitle{font-size:12px;color:#8892b0;margin-bottom:14px}
.agent-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #2a2f4533;font-size:13px}
.agent-row:last-child{border-bottom:none}
.agent-name{font-weight:500;color:#c8cee0}
.office-tags{display:flex;gap:4px;flex-wrap:wrap}
.office-tag{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600;white-space:nowrap}

/* ERD */
.erd-container{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;overflow-x:auto}
.erd-grid{display:flex;gap:16px;align-items:flex-start;justify-content:center;flex-wrap:wrap;min-width:800px}
.erd-table{background:#0f1117;border:1px solid #2a2f45;border-radius:10px;min-width:180px;overflow:hidden}
.erd-table .table-header{background:linear-gradient(135deg,#60a5fa22,#a78bfa22);padding:10px 14px;font-size:13px;font-weight:700;color:#60a5fa;border-bottom:1px solid #2a2f45;text-align:center}
.erd-table .field{padding:6px 14px;font-size:12px;color:#a0a8c0;border-bottom:1px solid #2a2f4522;display:flex;justify-content:space-between;gap:8px}
.erd-table .field:last-child{border-bottom:none}
.erd-table .field .key{color:#e8c840;font-weight:600}
.erd-table .field .fk{color:#a78bfa;font-weight:600}
.erd-table .field .type{color:#555c72;font-size:11px}
.erd-arrow{display:flex;align-items:center;color:#2a2f45;font-size:24px;padding-top:40px}

/* Comparison Table */
.compare-table{width:100%;border-collapse:collapse;font-size:13px;background:#1a1f36;border-radius:12px;overflow:hidden}
.compare-table th{padding:12px 16px;text-align:left;background:#0f1117;color:#60a5fa;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.3px;border-bottom:1px solid #2a2f45}
.compare-table td{padding:10px 16px;border-bottom:1px solid #2a2f4544;color:#a0a8c0}
.compare-table tr:hover td{background:#2a2f4522}
.compare-table .dim{color:#555c72}
.check{color:#4ade80}
.cross{color:#f87171}

/* Impact callout */
.callout{background:linear-gradient(135deg,#60a5fa11,#a78bfa11);border:1px solid #60a5fa33;border-radius:12px;padding:20px 24px;margin:20px 0}
.callout h3{font-size:15px;font-weight:600;color:#60a5fa;margin-bottom:8px}
.callout p{font-size:13px;color:#a0a8c0}
.callout code{background:#0f1117;padding:2px 6px;border-radius:4px;font-size:12px;color:#a78bfa}

.flex-row{display:flex;gap:16px;align-items:stretch}
@media(max-width:900px){.flex-row{flex-direction:column}}
.flex-row > *{flex:1}

/* Integration tab styles */
.xml-block{background:#0f1117;border:1px solid #2a2f45;border-radius:8px;padding:16px;font-family:'Fira Code','Consolas',monospace;font-size:12px;overflow-x:auto;line-height:1.7}
.xml-block .tag{color:#60a5fa}
.xml-block .attr{color:#a78bfa}
.xml-block .val{color:#4ade80}
.xml-block .comment{color:#555c72;font-style:italic}
.xml-block .highlight{background:#f59e0b18;border-left:3px solid #f59e0b;padding-left:8px;margin:-2px -8px;display:block}
.flow-diagram{display:flex;align-items:center;gap:0;flex-wrap:wrap;justify-content:center;padding:20px 0}
.flow-box{background:#1a1f36;border:1px solid #2a2f45;border-radius:10px;padding:14px 18px;text-align:center;min-width:120px}
.flow-box .label{font-size:11px;color:#8892b0;text-transform:uppercase;letter-spacing:.4px}
.flow-box .name{font-size:14px;font-weight:600;color:#c8cee0;margin-top:2px}
.flow-arrow{color:#2a2f45;font-size:24px;padding:0 8px;flex-shrink:0}
.flow-arrow.reaxml{color:#f59e0b}
.mapping-row{display:grid;grid-template-columns:1fr 40px 1fr;gap:0;align-items:center;padding:10px 0;border-bottom:1px solid #2a2f4533;font-size:13px}
.mapping-row:last-child{border-bottom:none}
.mapping-from{text-align:right;padding-right:12px;color:#f59e0b}
.mapping-arrow-sm{text-align:center;color:#2a2f45;font-size:16px}
.mapping-to{padding-left:12px;color:#60a5fa}
.crm-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.crm-card{background:#0f1117;border:1px solid #2a2f45;border-radius:8px;padding:14px;text-align:center}
.crm-card .crm-name{font-size:14px;font-weight:600;color:#c8cee0}
.crm-card .crm-detail{font-size:11px;color:#555c72;margin-top:4px}
.crm-card .crm-feeds{font-size:11px;color:#a78bfa;margin-top:6px}
.warn-box{background:#f59e0b0a;border:1px solid #f59e0b33;border-radius:8px;padding:14px;font-size:13px;color:#a0a8c0;margin-top:12px}
.warn-box strong{color:#f59e0b}
</style>
</head>
<body>

<div class="header">
  <h1>Real Estate Agency Models &amp; Data Architecture</h1>
  <p>Research findings for the RealEasy data model — proving the multi-office agent pattern with real-world data</p>
</div>

<div class="container">

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-tab="models">Agency Models</div>
  <div class="tab" data-tab="evidence">Evidence &amp; Overlap Data</div>
  <div class="tab" data-tab="datamodel">Proposed Data Model</div>
  <div class="tab" data-tab="integration">REAXML &amp; CRM Integration</div>
</div>

<!-- ======================== TAB 1: MODELS ======================== -->
<div class="tab-content active" id="tab-models">

<div class="section-title"><span class="num">1</span> Three Distinct Operating Models Observed</div>

<div class="model-grid">
  <!-- Model A -->
  <div class="model-card">
    <div class="badge" style="background:#4ade8022;color:#4ade80">Model A</div>
    <h3>Single-Office Licensee</h3>
    <div class="desc">One licensee, one physical office, agents work exclusively for that office. The simplest and most common model — what your current Group &gt; Agency &gt; Agent hierarchy assumes.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">LJ Hooker Mooloolaba | Mountain Creek</div>
      <div class="example-detail">Licensee: Jodi Price &amp; Michael Price<br>1 office · 6 staff · 69 sold listings<br>Shop 1b, Mountain Creek Shopping Centre</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Agents belong to exactly one office</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Clean 1:N relationship (office → agents)</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Works with simple hierarchy</div>
  </div>

  <!-- Model B -->
  <div class="model-card">
    <div class="badge" style="background:#f59e0b22;color:#f59e0b">Model B</div>
    <h3>Multi-Office Group (Same Licensee)</h3>
    <div class="desc">One business entity operates multiple branded offices across suburbs. Agents float between offices. Appears as separate agencies externally but is one business internally.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">Belle Property (Lower North Shore)</div>
      <div class="example-detail">Principals: Smythe, Jackson &amp; Benjafield<br>4 offices · ~12 agents across all<br>Mosman · Neutral Bay · Crows Nest · Cammeray</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f59e0b"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Agents belong to MULTIPLE offices</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f59e0b"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Same ABN, same trust account</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f87171"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <strong style="color:#f87171">Breaks simple hierarchy</strong></div>
  </div>

  <!-- Model C -->
  <div class="model-card">
    <div class="badge" style="background:#a78bfa22;color:#a78bfa">Model C</div>
    <h3>Branded Group (Shared Pool)</h3>
    <div class="desc">Explicit multi-office brand with a single shared team, shared database, and pooled agent resources. Often uses a "Group" suffix. One team, many locations.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">Ray White Lower North Shore Group</div>
      <div class="example-detail">Directors: Richard Harding &amp; Geoff Smith<br>3 offices · 70 staff · shared database<br>Mosman · Crows Nest · Cammeray</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#a78bfa"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> "Three offices. One team. One database."</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#a78bfa"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Agents explicitly cross-office</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f87171"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <strong style="color:#f87171">Breaks simple hierarchy</strong></div>
  </div>
</div>

<div class="callout" style="margin-top:20px">
  <h3>Key Insight</h3>
  <p>Models B and C are functionally identical — the only difference is transparency. Belle Property presents four "separate" agencies to the public while operating as one. Ray White LNS is upfront about being "one group." Both require the same data model: <code>Agent ↔ Office</code> must be <strong>many-to-many</strong>, not one-to-many.</p>
</div>

<div class="section-title" style="margin-top:28px"><span class="num">2</span> Side-by-Side Model Comparison</div>

<div style="border-radius:12px;overflow:hidden;border:1px solid #2a2f45">
<table class="compare-table">
<thead>
<tr><th>Attribute</th><th style="color:#4ade80">Model A — Single Office</th><th style="color:#f59e0b">Model B — Multi-Office (Hidden)</th><th style="color:#a78bfa">Model C — Branded Group</th></tr>
</thead>
<tbody>
<tr><td>Example</td><td>LJ Hooker Mooloolaba</td><td>Belle Property LNS</td><td>Ray White LNS Group</td></tr>
<tr><td>Offices</td><td>1</td><td>4 (appear separate)</td><td>3 (branded as group)</td></tr>
<tr><td>Team size</td><td>6</td><td>~12</td><td>70</td></tr>
<tr><td>Licensees/Principals</td><td>Jodi &amp; Michael Price</td><td>Smythe, Jackson, Benjafield</td><td>Harding &amp; Smith</td></tr>
<tr><td>Agent floats across offices?</td><td class="cross">✗ No</td><td class="check">✓ Yes (undisclosed)</td><td class="check">✓ Yes (explicit)</td></tr>
<tr><td>Shared database?</td><td class="dim">N/A (one office)</td><td class="check">✓ Yes</td><td class="check">✓ Yes (stated)</td></tr>
<tr><td>Shared Instagram?</td><td class="dim">Single brand</td><td class="check">✓ @belleneutralbay&hellip;</td><td class="check">✓ @raywhitelnsgroup</td></tr>
<tr><td>Rate My Agent listing</td><td>Single office</td><td>Combined: "NB, Mosman, CN &amp; Cammeray"</td><td>Single group</td></tr>
<tr><td>Public perception</td><td>One agency</td><td>Four agencies</td><td>One group, 3 locations</td></tr>
<tr><td>Data model impact</td><td class="check">✓ Simple 1:N</td><td class="cross">✗ Requires M:N</td><td class="cross">✗ Requires M:N</td></tr>
</tbody>
</table>
</div>

</div>

<!-- ======================== TAB 2: EVIDENCE ======================== -->
<div class="tab-content" id="tab-evidence">

<div class="section-title"><span class="num">1</span> Agent-to-Office Relationships — Network Visualisation</div>

<div class="graph-container" style="height:520px">
  <svg id="networkGraph"></svg>
  <div class="graph-legend">
    <div class="item"><div class="dot" style="background:#60a5fa"></div> Brand / Group</div>
    <div class="item"><div class="dot" style="background:#a78bfa"></div> Office</div>
    <div class="item"><div class="dot" style="background:#4ade80"></div> Agent (single office)</div>
    <div class="item"><div class="dot" style="background:#f59e0b"></div> Agent (multi-office)</div>
  </div>
  <div class="graph-title">Belle Property Lower North Shore</div>
</div>

<div class="section-title"><span class="num">2</span> Confirmed Agent Overlaps</div>

<div class="overlap-grid">
  <div class="overlap-card">
    <h3>Belle Property — Agent × Office Matrix</h3>
    <div class="subtitle">Principals listed across all 4 offices; agents float between them</div>
    <div id="belleOverlap"></div>
  </div>
  <div class="overlap-card">
    <h3>Ray White LNS — Agent Pool Model</h3>
    <div class="subtitle">"Three offices. One team. One Database." — 70 staff shared</div>
    <div id="rwOverlap"></div>
  </div>
</div>

<div class="section-title"><span class="num">3</span> LJ Hooker (Control) — No Overlap</div>

<div class="overlap-card" style="max-width:600px">
  <h3>LJ Hooker Mooloolaba | Mountain Creek</h3>
  <div class="subtitle">All 6 agents belong exclusively to the single office</div>
  <div id="ljhOverlap"></div>
</div>

</div>

<!-- ======================== TAB 3: DATA MODEL ======================== -->
<div class="tab-content" id="tab-datamodel">

<div class="section-title"><span class="num">1</span> Current Model (Breaks on Model B &amp; C)</div>

<div class="callout" style="border-color:#f8717133;background:#f8717108">
  <h3 style="color:#f87171">Problem</h3>
  <p>The current <code>Group → Agency → Agent</code> model assumes an agent belongs to exactly one agency. This fails when the same agent (e.g. Matthew Smythe) appears under Belle Property Mosman, Neutral Bay, Crows Nest, AND Cammeray — or when Ray White's 70 staff operate as one pool across 3 offices.</p>
</div>

<div class="erd-container" style="margin-bottom:24px">
  <div style="text-align:center;margin-bottom:16px;color:#f87171;font-weight:600;font-size:14px">❌ Current (Broken) Model</div>
  <div class="erd-grid">
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Group</div>
      <div class="field"><span><span class="key">PK</span> group_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">→</div>
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Agency</div>
      <div class="field"><span><span class="key">PK</span> agency_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> group_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">→</div>
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Agent</div>
      <div class="field"><span><span class="key">PK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> agency_id</span><span class="type">int ⚠️</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:12px;font-size:12px;color:#f87171">⚠️ Agent.agency_id forces a single agency — cannot represent multi-office agents</div>
</div>

<div class="section-title"><span class="num">2</span> Proposed Model (Handles All Three Patterns)</div>

<div class="callout">
  <h3>Solution</h3>
  <p>Introduce a <code>BusinessEntity</code> (the licensee/principal) between Brand and Office, and replace the direct <code>Agent → Office</code> FK with a junction table <code>AgentOffice</code>. This supports agents belonging to one OR many offices, while preserving the business ownership hierarchy.</p>
</div>

<div class="erd-container">
  <div style="text-align:center;margin-bottom:16px;color:#4ade80;font-weight:600;font-size:14px">✓ Proposed Model</div>
  <div class="erd-grid">
    <div class="erd-table">
      <div class="table-header">Brand</div>
      <div class="field"><span><span class="key">PK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>website</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table">
      <div class="table-header">BusinessEntity</div>
      <div class="field"><span><span class="key">PK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span>abn</span><span class="type">str</span></div>
      <div class="field"><span>licence_no</span><span class="type">str</span></div>
      <div class="field"><span>trust_account</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>suburb</span><span class="type">str</span></div>
      <div class="field"><span>address</span><span class="type">str</span></div>
      <div class="field"><span>phone</span><span class="type">str</span></div>
    </div>
  </div>
  <div style="display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap">
    <div class="erd-table">
      <div class="table-header">Agent</div>
      <div class="field"><span><span class="key">PK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>phone</span><span class="type">str</span></div>
      <div class="field"><span>email</span><span class="type">str</span></div>
      <div class="field"><span>licence_no</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">M:N ↔</div>
    <div class="erd-table" style="border-color:#a78bfa44">
      <div class="table-header" style="background:linear-gradient(135deg,#a78bfa22,#60a5fa22)">AgentOffice ★</div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span>role</span><span class="type">str</span></div>
      <div class="field"><span>is_primary</span><span class="type">bool</span></div>
      <div class="field"><span>start_date</span><span class="type">date</span></div>
      <div class="field"><span>end_date</span><span class="type">date?</span></div>
    </div>
    <div class="erd-arrow">↔ N:1</div>
    <div class="erd-table">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span>(see above)</span><span class="type"></span></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:16px;font-size:12px;color:#4ade80">★ Junction table allows agents to belong to 1 or more offices with role context</div>
</div>

<div class="section-title"><span class="num">3</span> How Each Model Maps</div>

<div style="border-radius:12px;overflow:hidden;border:1px solid #2a2f45">
<table class="compare-table">
<thead><tr><th>Scenario</th><th>Brand</th><th>BusinessEntity</th><th>Offices</th><th>AgentOffice rows</th></tr></thead>
<tbody>
<tr>
  <td style="color:#4ade80">LJ Hooker MMC<br><span class="dim">Model A</span></td>
  <td>LJ Hooker</td>
  <td>1 (Price family)</td>
  <td>1 (Mtn Creek)</td>
  <td>6 rows (1 per agent × 1 office)</td>
</tr>
<tr>
  <td style="color:#f59e0b">Belle Property LNS<br><span class="dim">Model B</span></td>
  <td>Belle Property</td>
  <td>1 (Smythe/Jackson/Benjafield)</td>
  <td>4 (Mosman, NB, CN, Cammeray)</td>
  <td>~36 rows (agents × offices they serve)</td>
</tr>
<tr>
  <td style="color:#a78bfa">Ray White LNS<br><span class="dim">Model C</span></td>
  <td>Ray White</td>
  <td>1 (Harding &amp; Smith)</td>
  <td>3 (Mosman, CN, Cammeray)</td>
  <td>~210 rows (70 staff × 3 offices)</td>
</tr>
</tbody>
</table>
</div>

<div class="callout" style="margin-top:20px">
  <h3>Additional Fields to Consider</h3>
  <p><code>AgentOffice.role</code> — captures whether someone is "Principal", "Sales Agent", "Property Manager" etc. at each specific office.<br>
  <code>AgentOffice.is_primary</code> — flags the agent's "home" office for display/default purposes.<br>
  <code>AgentOffice.start_date / end_date</code> — handles agent movement between offices over time (historically important for sold listing attribution).<br>
  <code>BusinessEntity.abn</code> — the real identifier that ties offices together, even when branding hides the relationship.</p>
</div>

</div>

<!-- ======================== TAB 4: INTEGRATION ======================== -->
<div class="tab-content" id="tab-integration">

<div class="section-title"><span class="num">1</span> RealEasy Platform &amp; CRM Integration</div>

<div class="card" style="background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;margin-bottom:20px">
  <p style="font-size:13px;color:#8892b0;margin-bottom:16px">RealEasy is a classifieds portal in its own right — agencies and agents are onboarded directly onto the platform. CRM integration is an <strong style="color:#60a5fa">optional bidirectional convenience layer</strong> that makes it easier for onboarded agencies to manage their listings and receive leads, not the source of truth for the relationship.</p>

  <div style="display:flex;flex-direction:column;gap:20px;margin:16px 0">
    <!-- The core relationship -->
    <div style="text-align:center;margin-bottom:4px">
      <span style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#4ade80;font-weight:600">Core Relationship (Always)</span>
    </div>
    <div class="flow-diagram" style="justify-content:center;gap:12px">
      <div class="flow-box" style="border-color:#4ade8044;border-width:2px"><div class="label" style="color:#4ade80">Agency / Agent</div><div class="name" style="color:#4ade80">Onboarded directly</div></div>
      <div class="flow-arrow" style="color:#4ade80">↔ owns relationship ↔</div>
      <div class="flow-box" style="border-color:#60a5fa44;border-width:2px"><div class="label">Portal</div><div class="name" style="color:#60a5fa">RealEasy</div></div>
    </div>

    <div style="text-align:center;border-top:1px dashed #2a2f45;padding-top:16px;margin-bottom:4px">
      <span style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#a78bfa;font-weight:600">CRM Integration Layer (Optional, Bidirectional)</span>
    </div>
    <div class="flow-diagram" style="flex-wrap:wrap;justify-content:center;gap:12px">
      <div class="flow-box" style="border-color:#a78bfa44"><div class="label">CRM Source</div><div class="name" style="color:#a78bfa">REX / Agentbox / VaultRE</div></div>
      <div style="display:flex;flex-direction:column;gap:4px;align-items:center;justify-content:center">
        <div class="flow-arrow reaxml" style="flex-shrink:0;margin:0">→ REAXML →</div>
        <span style="font-size:10px;color:#8892b0">listings sync</span>
      </div>
      <div class="flow-box" style="border-color:#60a5fa44;border-width:2px"><div class="label">Portal</div><div class="name" style="color:#60a5fa">RealEasy</div></div>
      <div style="display:flex;flex-direction:column;gap:4px;align-items:center;justify-content:center">
        <div class="flow-arrow" style="flex-shrink:0;margin:0;color:#4ade80">→ Vendor Leads →</div>
        <span style="font-size:10px;color:#8892b0">appraisal opportunities</span>
        <div class="flow-arrow" style="flex-shrink:0;margin:0;color:#f59e0b">→ Enquiries →</div>
        <span style="font-size:10px;color:#8892b0">buyer interest</span>
      </div>
      <div class="flow-box" style="border-color:#a78bfa44"><div class="label">CRM Inbox</div><div class="name" style="color:#a78bfa">REX / Agentbox / VaultRE</div></div>
    </div>

    <div style="text-align:center;border-top:1px dashed #2a2f45;padding-top:16px;margin-bottom:4px">
      <span style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#f59e0b;font-weight:600">Peer Portals (Same REAXML Source)</span>
    </div>
    <div class="flow-diagram" style="flex-wrap:wrap;justify-content:center;gap:12px">
      <div class="flow-box" style="border-color:#a78bfa44"><div class="label">CRM Source</div><div class="name" style="color:#a78bfa">REX / Agentbox / VaultRE</div></div>
      <div class="flow-arrow reaxml" style="flex-shrink:0">→ REAXML →</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="flow-box" style="border-color:#f59e0b44"><div class="label">Portal</div><div class="name" style="color:#f59e0b">realestate.com.au</div></div>
        <div class="flow-box" style="border-color:#f59e0b44"><div class="label">Portal</div><div class="name" style="color:#f59e0b">Domain</div></div>
      </div>
    </div>
  </div>

  <div class="warn-box" style="margin-top:8px"><strong>Key:</strong> The agency/agent relationship exists in RealEasy <em>before</em> any CRM integration. REAXML feeds are an optional sync for listing management. Two outbound flows push into CRMs: <strong style="color:#4ade80">vendor leads</strong> (homeowners wanting to sell, matched to agencies — RealEasy's core value prop) and <strong style="color:#f59e0b">buyer enquiries</strong> (interest on live listings — standard portal model).</div>
</div>

<div class="section-title"><span class="num">2</span> REAXML Listing Structure — Agent/Office Fields</div>

<div class="overlap-grid">
  <div class="overlap-card">
    <h3 style="color:#f59e0b">Sample REAXML Listing</h3>
    <div class="subtitle">Key agent-related fields highlighted</div>
    <div class="xml-block">
<span class="tag">&lt;propertyList&gt;</span>
  <span class="tag">&lt;residential</span> <span class="attr">status=</span><span class="val">"sold"</span><span class="tag">&gt;</span>
<span class="highlight">    <span class="tag">&lt;agentID&gt;</span><span class="val">XNWXNW</span><span class="tag">&lt;/agentID&gt;</span> <span class="comment">&lt;!-- Office/Agency ID --&gt;</span></span>
    <span class="tag">&lt;uniqueID&gt;</span><span class="val">PROP-8842</span><span class="tag">&lt;/uniqueID&gt;</span>
<span class="highlight">    <span class="tag">&lt;listingAgent</span> <span class="attr">id=</span><span class="val">"1"</span><span class="tag">&gt;</span> <span class="comment">&lt;!-- Primary agent --&gt;</span>
      <span class="tag">&lt;name&gt;</span><span class="val">Jodi Price</span><span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;telephone</span> <span class="attr">type=</span><span class="val">"mobile"</span><span class="tag">&gt;</span><span class="val">0412 278 658</span><span class="tag">&lt;/telephone&gt;</span>
      <span class="tag">&lt;email&gt;</span><span class="val">jodi@ljhookermmc.com.au</span><span class="tag">&lt;/email&gt;</span>
    <span class="tag">&lt;/listingAgent&gt;</span></span>
<span class="highlight">    <span class="tag">&lt;listingAgent</span> <span class="attr">id=</span><span class="val">"2"</span><span class="tag">&gt;</span> <span class="comment">&lt;!-- Second agent --&gt;</span>
      <span class="tag">&lt;name&gt;</span><span class="val">Sharnie Shaw</span><span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;telephone</span> <span class="attr">type=</span><span class="val">"mobile"</span><span class="tag">&gt;</span><span class="val">0427 882 198</span><span class="tag">&lt;/telephone&gt;</span>
      <span class="tag">&lt;email&gt;</span><span class="val">sharnie@ljhookermmc.com.au</span><span class="tag">&lt;/email&gt;</span>
    <span class="tag">&lt;/listingAgent&gt;</span></span>
    <span class="tag">&lt;price&gt;</span><span class="val">1175000</span><span class="tag">&lt;/price&gt;</span>
    <span class="tag">&lt;address&gt;</span>...<span class="tag">&lt;/address&gt;</span>
    <span class="tag">&lt;features&gt;</span>...<span class="tag">&lt;/features&gt;</span>
  <span class="tag">&lt;/residential&gt;</span>
<span class="tag">&lt;/propertyList&gt;</span>
    </div>
  </div>

  <div class="overlap-card">
    <h3 style="color:#60a5fa">What REAXML Gives You (and Doesn't)</h3>
    <div class="subtitle">Critical constraints for your integration</div>
    <div style="margin-top:8px">
      <div class="agent-row"><span class="agent-name" style="color:#4ade80">agentID</span><span style="font-size:12px;color:#8892b0">Identifies the <strong>office/agency</strong> — NOT the individual agent. <strong style="color:#4ade80">Generated by RealEasy</strong> on portal activation (e.g. <code>RE + base36(office_id)</code>), persisted as <code>Office.feed_code</code>. Agency configures this in their CRM's outbound feed settings.</span></div>
      <div class="agent-row"><span class="agent-name" style="color:#4ade80">uniqueID</span><span style="font-size:12px;color:#8892b0">Listing ID, unique <em>within</em> an agentID. Composite key: <code style="color:#a78bfa">agentID + uniqueID</code></span></div>
      <div class="agent-row"><span class="agent-name" style="color:#f59e0b">listingAgent (×4)</span><span style="font-size:12px;color:#8892b0">Up to 4 agents per listing. Has name, phone, email — but <strong>NO unique agent ID</strong>.</span></div>
      <div class="agent-row"><span class="agent-name" style="color:#f87171">No agent ID</span><span style="font-size:12px;color:#8892b0">Agents are identified by name + email only. No stable identifier. Same agent at different offices = different email potentially.</span></div>
      <div class="agent-row"><span class="agent-name" style="color:#f87171">No brand/group</span><span style="font-size:12px;color:#8892b0">REAXML has no concept of franchise/brand. Each office gets its own agentID. You must infer the brand.</span></div>
      <div class="agent-row"><span class="agent-name" style="color:#f87171">No business entity</span><span style="font-size:12px;color:#8892b0">No ABN, licence number, or parent entity. Multi-office groups appear as separate unrelated feeds.</span></div>
    </div>
    <div class="warn-box"><strong>The upside:</strong> Because RealEasy onboards agencies/agents directly, you <em>already know</em> the office and agent identities before any REAXML feed arrives. Belle Property's 4 offices would arrive as 4 separate feeds, each with a different <code style="color:#a78bfa">agentID</code> — but you've already linked them under the same BusinessEntity during onboarding. The REAXML feed just needs to match against your existing records, not create them.</div>
  </div>
</div>

<div class="section-title"><span class="num">3</span> REAXML → RealEasy Field Mapping</div>

<div class="overlap-card" style="max-width:700px">
  <h3>Inbound Feed Mapping</h3>
  <div class="subtitle">How REAXML fields match to <em>existing</em> RealEasy records (onboarded first, then synced)</div>
  <div style="display:grid;grid-template-columns:1fr 40px 1fr;gap:0;padding:10px 0;border-bottom:2px solid #2a2f45;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.4px">
    <span style="text-align:right;padding-right:12px;color:#f59e0b">REAXML Field</span>
    <span style="text-align:center;color:#555c72">→</span>
    <span style="padding-left:12px;color:#60a5fa">RealEasy Entity.Field</span>
  </div>
  <div class="mapping-row"><span class="mapping-from">&lt;agentID&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Office.feed_code <span style="color:#4ade80">(indexed lookup)</span></span></div>
  <div class="mapping-row"><span class="mapping-from">&lt;uniqueID&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Listing.external_unique_id</span></div>
  <div class="mapping-row"><span class="mapping-from">&lt;listingAgent&gt;/&lt;name&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Agent.name <span style="color:#555c72">(fuzzy match)</span></span></div>
  <div class="mapping-row"><span class="mapping-from">&lt;listingAgent&gt;/&lt;email&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Agent.email <span style="color:#4ade80">(best match key)</span></span></div>
  <div class="mapping-row"><span class="mapping-from">&lt;listingAgent&gt;/&lt;telephone&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Agent.phone</span></div>
  <div class="mapping-row"><span class="mapping-from">&lt;listingAgent id="N"&gt;</span><span class="mapping-arrow-sm">→</span><span class="mapping-to">ListingAgent.position (1=primary)</span></div>
  <div class="mapping-row"><span class="mapping-from"><span style="color:#f87171">— not provided —</span></span><span class="mapping-arrow-sm">→</span><span class="mapping-to">Brand <span style="color:#555c72">(infer from office name / enrichment)</span></span></div>
  <div class="mapping-row"><span class="mapping-from"><span style="color:#f87171">— not provided —</span></span><span class="mapping-arrow-sm">→</span><span class="mapping-to">BusinessEntity <span style="color:#555c72">(infer from ABN lookup)</span></span></div>
</div>

<div class="section-title"><span class="num">4</span> Agent Identity Resolution — The Hard Problem</div>

<div class="callout" style="border-color:#4ade8033;background:#4ade8008">
  <h3 style="color:#4ade80">Agent Matching — Not Creation</h3>
  <p>Because RealEasy onboards agents directly, inbound REAXML feeds don't <em>create</em> agent records — they <strong>match against existing ones</strong>. REAXML has no stable agent ID (agents are identified by name + email + phone only), but since you already hold the canonical agent record from onboarding, you just need to link the feed's <code>listingAgent</code> to the correct RealEasy agent. This is a simpler problem than cold deduplication:</p>
</div>

<div class="overlap-card" style="margin-top:12px">
  <h3>Scenario: Matthew Smythe across Belle Property feeds</h3>
  <div class="subtitle">Same person, 4 different REAXML feeds, potentially different contact details</div>
  <div class="xml-block" style="font-size:11px;margin-top:10px">
<span class="comment">/* Feed 1: Belle Property Mosman (agentID: BP_MOS) */</span>
<span class="tag">&lt;listingAgent</span> <span class="attr">id=</span><span class="val">"1"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;name&gt;</span><span class="val">Matthew Smythe</span><span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;email&gt;</span><span class="val">matthew.smythe@belleproperty.com</span><span class="tag">&lt;/email&gt;</span>
<span class="tag">&lt;/listingAgent&gt;</span>

<span class="comment">/* Feed 2: Belle Property Neutral Bay (agentID: BP_NB) */</span>
<span class="tag">&lt;listingAgent</span> <span class="attr">id=</span><span class="val">"1"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;name&gt;</span><span class="val">Matthew Smythe</span><span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;email&gt;</span><span class="val">m.smythe@belleproperty.com</span><span class="tag">&lt;/email&gt;</span> <span class="comment">&lt;!-- different email! --&gt;</span>
<span class="tag">&lt;/listingAgent&gt;</span>

<span class="comment">/* Feed 3: Belle Property Crows Nest (agentID: BP_CN) */</span>
<span class="tag">&lt;listingAgent</span> <span class="attr">id=</span><span class="val">"1"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;name&gt;</span><span class="val">Matt Smythe</span><span class="tag">&lt;/name&gt;</span> <span class="comment">&lt;!-- different name format! --&gt;</span>
  <span class="tag">&lt;email&gt;</span><span class="val">matthew.smythe@belleproperty.com</span><span class="tag">&lt;/email&gt;</span>
<span class="tag">&lt;/listingAgent&gt;</span>
  </div>
  <p style="font-size:12px;color:#8892b0;margin-top:12px">Without onboarding, this creates 3 separate Agent records. But since RealEasy already holds Matthew Smythe's canonical record from onboarding, the feed just needs to match against it. Your matching pipeline:</p>
  <div style="margin-top:10px">
    <div class="agent-row"><span class="agent-name" style="color:#4ade80">1. Office scoping</span><span style="font-size:12px;color:#8892b0">REAXML <code>agentID</code> maps to a known Office — narrow the agent search to that office's roster</span></div>
    <div class="agent-row"><span class="agent-name" style="color:#4ade80">2. Email match</span><span style="font-size:12px;color:#8892b0">Normalised email against the agents already linked to this office (via AgentOffice)</span></div>
    <div class="agent-row"><span class="agent-name" style="color:#4ade80">3. Name fuzzy fallback</span><span style="font-size:12px;color:#8892b0">"Matt Smythe" ≈ "Matthew Smythe" — only needed if email doesn't match (e.g. CRM uses a different alias)</span></div>
    <div class="agent-row"><span class="agent-name" style="color:#4ade80">4. Unmatched → flag for review</span><span style="font-size:12px;color:#8892b0">If no match found, queue for manual linking rather than auto-creating — the agent may not be onboarded yet</span></div>
  </div>
</div>

<div class="section-title"><span class="num">5</span> CRM Source Landscape</div>

<div class="crm-grid" style="margin-bottom:16px">
  <div class="crm-card" style="border-color:#a78bfa44">
    <div class="crm-name" style="color:#a78bfa">REX CRM</div>
    <div class="crm-detail">Multi-office shared database<br>Same API as main app<br>OAuth authentication</div>
    <div class="crm-feeds">Feeds: REAXML, REIV, REIWA, Domain</div>
  </div>
  <div class="crm-card" style="border-color:#60a5fa44">
    <div class="crm-name" style="color:#60a5fa">Agentbox (Reapit)</div>
    <div class="crm-detail">#1 used by AU Top 100 agents<br>CoreLogic Prospector built-in<br>JSON API available</div>
    <div class="crm-feeds">Feeds: REAXML via Red Square EAC</div>
  </div>
  <div class="crm-card" style="border-color:#4ade80aa">
    <div class="crm-name" style="color:#4ade80">VaultRE (MRI Vault)</div>
    <div class="crm-detail">End-to-end: CRM → trust accounting<br>Sales + PM in one platform<br>Xero integration</div>
    <div class="crm-feeds">Feeds: REAXML, portal-direct</div>
  </div>
  <div class="crm-card" style="border-color:#f59e0b44">
    <div class="crm-name" style="color:#f59e0b">Other (Box+Dice, Zenu, LockedOn)</div>
    <div class="crm-detail">Various smaller CRMs<br>Common in indie agencies<br>Variable API quality</div>
    <div class="crm-feeds">Feeds: REAXML (common denominator)</div>
  </div>
</div>

<div class="section-title"><span class="num">6</span> Portal Activation — Agent Dashboard</div>

<div class="card" style="background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;margin-bottom:20px">
  <p style="font-size:13px;color:#8892b0;margin-bottom:16px">Once an agency is onboarded, the agent dashboard provides a self-service <strong style="color:#4ade80">Portal Activation</strong> step to connect their CRM. No stored identifier is needed — the feed code is derived deterministically from the office record.</p>

  <div style="background:#0d1117;border:1px solid #2a2f45;border-radius:8px;padding:20px;margin:12px 0;font-family:'Courier New',monospace;font-size:12px">
    <div style="color:#555c72;margin-bottom:12px">── Agent Dashboard › CRM Integration ──</div>
    <div style="margin-bottom:16px">
      <div style="color:#8892b0;margin-bottom:4px">Your RealEasy Feed Credentials:</div>
      <div style="display:grid;grid-template-columns:140px 1fr;gap:6px 12px;margin-left:12px">
        <span style="color:#64748b">Feed Code (agentID)</span><span style="color:#4ade80;font-weight:bold">RE3AX</span>
        <span style="color:#64748b">Feed Endpoint</span><span style="color:#60a5fa">https://feed.realeasy.com.au/reaxml</span>
        <span style="color:#64748b">Office</span><span style="color:#8892b0">LJ Hooker Mooloolaba | Mountain Creek</span>
        <span style="color:#64748b">Generated from</span><span style="color:#64748b">office_id 4217 → "RE" + base36(4217) → RE3AX (stored on activation)</span>
      </div>
    </div>
    <div style="margin-bottom:16px">
      <div style="color:#8892b0;margin-bottom:4px">CRM Setup Instructions:</div>
      <div style="margin-left:12px;color:#64748b;line-height:1.8">
        <div><span style="color:#f59e0b">1.</span> In your CRM, navigate to portal/feed settings</div>
        <div><span style="color:#f59e0b">2.</span> Add a new portal destination: <span style="color:#60a5fa">RealEasy</span></div>
        <div><span style="color:#f59e0b">3.</span> Enter your Feed Code as the Agent ID: <span style="color:#4ade80;font-weight:bold">RE3AX</span></div>
        <div><span style="color:#f59e0b">4.</span> Set the feed endpoint URL above</div>
        <div><span style="color:#f59e0b">5.</span> Enable the feed — listings will sync automatically</div>
      </div>
    </div>
    <div>
      <div style="color:#8892b0;margin-bottom:4px">CRM Push-Back (optional):</div>
      <div style="margin-left:12px;color:#64748b;line-height:1.8">
        <div><span style="color:#f59e0b">●</span> CRM type: <span style="color:#a78bfa">REX</span> <span style="color:#64748b">[dropdown]</span></div>
        <div><span style="color:#f59e0b">●</span> OAuth: <span style="color:#4ade80">Connected</span> <span style="color:#64748b">[Authorise button]</span></div>
        <div><span style="color:#4ade80;font-size:11px">✓ Vendor leads (appraisal opportunities) → REX contacts</span></div>
        <div><span style="color:#f59e0b;font-size:11px">✓ Buyer enquiries (listing interest) → REX enquiries</span></div>
      </div>
    </div>
  </div>

  <div class="warn-box"><strong>Generated on activation, persisted:</strong> When the agency clicks "Activate Portal", the system generates <code>feed_code</code> from <code>office_id</code> (e.g. <code>"RE" + base36(4217) → RE3AX</code>) and stores it on the Office record. Inbound feeds are matched via a simple indexed lookup: <code>WHERE feed_code = 'RE3AX'</code>. The column is nullable — <code>NULL</code> means portal not yet activated.</div>
</div>

<div class="callout">
  <h3>Integration Strategy Summary</h3>
  <p style="margin-bottom:10px"><strong style="color:#4ade80">1. Onboarding (always first):</strong> Agency signs up to RealEasy → Brand, BusinessEntity, Office(s), and Agent(s) are created as RealEasy-owned canonical records. This is the source of truth — no CRM required.</p>
  <p style="margin-bottom:10px"><strong style="color:#a78bfa">2. Portal Activation (self-service):</strong> Agency clicks "Activate Portal" in the dashboard → system generates <code>feed_code</code> from <code>office_id</code>, persists it, and displays it with the endpoint URL. Agency configures their CRM with these credentials.</p>
  <p style="margin-bottom:10px"><strong style="color:#f59e0b">3. Inbound — Listing sync:</strong> REAXML feeds arrive with <code>agentID</code> = the stored <code>feed_code</code>. Simple indexed lookup to resolve the office. <code>listingAgent</code> matched against existing agents on that office's roster.</p>
  <p style="margin-bottom:10px"><strong style="color:#4ade80">4a. Outbound — Vendor leads:</strong> RealEasy markets to homeowners and generates vendor leads (appraisal opportunities) for matched agencies. Pushed to agent's CRM as new contacts. This is RealEasy's core value proposition — lead generation upstream of the listing.</p>
  <p style="margin-bottom:10px"><strong style="color:#f59e0b">4b. Outbound — Buyer enquiries:</strong> Buyers enquire on live listings → enquiries pushed to listing agent's CRM. Standard portal model, same as REA/Domain.</p>
  <p><strong style="color:#60a5fa">5. Direct API enrichment (future):</strong> REX/Agentbox APIs expose richer data than REAXML (stable agent IDs, office hierarchies). Could enhance sync quality over time. REAXML remains the universal baseline.</p>
</div>

<div class="section-title"><span class="num">7</span> Revised Complete Model — Onboarding-First with Integration Keys</div>

<div class="erd-container">
  <div style="text-align:center;margin-bottom:8px;color:#4ade80;font-weight:600;font-size:14px">✓ Final Model — RealEasy-Owned Entities + CRM Sync Fields</div>
  <div style="text-align:center;margin-bottom:16px;font-size:11px;color:#8892b0">
    <span style="display:inline-block;margin:0 8px"><span style="color:#4ade80">■</span> = onboarded (RealEasy-owned)</span>
    <span style="display:inline-block;margin:0 8px"><span style="color:#a78bfa">■</span> = CRM integration key (optional)</span>
    <span style="display:inline-block;margin:0 8px"><span style="color:#f59e0b">■</span> = arrives with REAXML feed</span>
  </div>

  <!-- Row 1: Brand → BusinessEntity → Office -->
  <div class="erd-grid">
    <div class="erd-table" style="border-color:#4ade8033">
      <div class="table-header">Brand</div>
      <div class="field"><span><span class="key">PK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">name</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">website</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table" style="border-color:#4ade8033">
      <div class="table-header">BusinessEntity</div>
      <div class="field"><span><span class="key">PK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">abn</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">licence_no</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">trust_account</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table" style="border-color:#4ade8033">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">name</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">suburb</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">feed_code</span><span class="type">str? UQ ★</span></div>
      <div class="field"><span style="color:#a78bfa">crm_type</span><span class="type">enum?</span></div>
      <div class="field"><span style="color:#a78bfa">rex_office_id</span><span class="type">str?</span></div>
      <div class="field"><span style="color:#a78bfa">domain_agency_id</span><span class="type">str?</span></div>
      <div class="field"><span style="color:#a78bfa">rea_agent_id</span><span class="type">str?</span></div>
    </div>
  </div>

  <!-- Row 2: Agent ↔ AgentOffice ↔ Office -->
  <div style="display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap;align-items:flex-start">
    <div class="erd-table" style="border-color:#4ade8033">
      <div class="table-header">Agent</div>
      <div class="field"><span><span class="key">PK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">name</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">email</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">phone</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">licence_no</span><span class="type">str</span></div>
      <div class="field"><span style="color:#a78bfa">rex_contact_id</span><span class="type">str?</span></div>
    </div>
    <div class="erd-arrow">M:N ↔</div>
    <div class="erd-table" style="border-color:#a78bfa44">
      <div class="table-header" style="background:linear-gradient(135deg,#a78bfa22,#60a5fa22)">AgentOffice</div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">role</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">is_primary</span><span class="type">bool</span></div>
      <div class="field"><span style="color:#4ade80">start_date</span><span class="type">date</span></div>
      <div class="field"><span style="color:#4ade80">end_date</span><span class="type">date?</span></div>
    </div>
    <div class="erd-arrow">↔ N:1</div>
    <div class="erd-table">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span>(ref)</span><span class="type"></span></div>
    </div>
  </div>

  <!-- Row 3: Listing → ListingAgent + Lead (new) -->
  <div style="display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap;align-items:flex-start">
    <div class="erd-table" style="border-color:#f59e0b44">
      <div class="table-header" style="background:linear-gradient(135deg,#f59e0b22,#f59e0b11);color:#f59e0b">Listing</div>
      <div class="field"><span><span class="key">PK</span> listing_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">address</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">status</span><span class="type">enum</span></div>
      <div class="field"><span style="color:#4ade80">price</span><span class="type">decimal?</span></div>
      <div class="field"><span style="color:#4ade80">beds / baths / cars</span><span class="type">int</span></div>
      <div class="field"><span style="color:#f59e0b">reaxml_unique_id</span><span class="type">str? ★</span></div>
      <div class="field"><span style="color:#4ade80">source</span><span class="type">enum</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table" style="border-color:#f59e0b44">
      <div class="table-header" style="background:linear-gradient(135deg,#f59e0b22,#f59e0b11);color:#f59e0b">ListingAgent</div>
      <div class="field"><span><span class="fk">FK</span> listing_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span>position</span><span class="type">int (1-4)</span></div>
      <div class="field"><span>is_conjunction</span><span class="type">bool</span></div>
    </div>
  </div>

  <!-- Row 4: VendorLead (pre-listing — RealEasy's core value proposition) -->
  <div style="margin-top:24px;margin-bottom:6px;text-align:center">
    <span style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#4ade80;font-weight:600">Pre-Listing — RealEasy → Agency</span>
  </div>
  <div style="display:flex;justify-content:center;gap:16px;margin-top:8px;flex-wrap:wrap;align-items:flex-start">
    <div class="erd-table" style="border-color:#4ade8055">
      <div class="table-header" style="background:linear-gradient(135deg,#4ade8022,#4ade8011);color:#4ade80">VendorLead</div>
      <div class="field"><span><span class="key">PK</span> vendor_lead_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int?</span></div>
      <div class="field"><span style="color:#4ade80">vendor_name</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">vendor_email</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">vendor_phone</span><span class="type">str?</span></div>
      <div class="field"><span style="color:#4ade80">property_address</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">message</span><span class="type">text?</span></div>
      <div class="field"><span style="color:#4ade80">created_at</span><span class="type">timestamp</span></div>
      <div class="field"><span style="color:#4ade80">status</span><span class="type">enum</span></div>
      <div class="field"><span style="color:#a78bfa">crm_push_status</span><span class="type">enum</span></div>
      <div class="field"><span style="color:#a78bfa">crm_push_ref</span><span class="type">str?</span></div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:0 8px">
      <div class="flow-arrow" style="color:#4ade80;margin:0;font-size:14px">→ push to CRM →</div>
      <span style="font-size:10px;color:#8892b0">as new contact/appraisal</span>
    </div>
    <div class="flow-box" style="border-color:#a78bfa44;min-width:120px"><div class="label">CRM Inbox</div><div class="name" style="color:#a78bfa;font-size:13px">Agent's CRM</div></div>
  </div>
  <div style="text-align:center;margin-top:8px;font-size:11px;color:#8892b0;font-style:italic">Homeowner wants to sell → RealEasy matches to a suitable agency → vendor lead pushed to agent's CRM as an appraisal opportunity. No listing exists yet.</div>

  <!-- Row 5: Enquiry (post-listing — buyer interest on live listing) -->
  <div style="margin-top:24px;margin-bottom:6px;text-align:center">
    <span style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#f59e0b;font-weight:600">Post-Listing — Buyer → Listing Agent</span>
  </div>
  <div style="display:flex;justify-content:center;gap:16px;margin-top:8px;flex-wrap:wrap;align-items:flex-start">
    <div class="erd-table" style="border-color:#f59e0b55">
      <div class="table-header" style="background:linear-gradient(135deg,#f59e0b22,#f59e0b11);color:#f59e0b">Enquiry</div>
      <div class="field"><span><span class="key">PK</span> enquiry_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> listing_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span style="color:#4ade80">buyer_name</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">buyer_email</span><span class="type">str</span></div>
      <div class="field"><span style="color:#4ade80">buyer_phone</span><span class="type">str?</span></div>
      <div class="field"><span style="color:#4ade80">message</span><span class="type">text?</span></div>
      <div class="field"><span style="color:#4ade80">created_at</span><span class="type">timestamp</span></div>
      <div class="field"><span style="color:#a78bfa">crm_push_status</span><span class="type">enum</span></div>
      <div class="field"><span style="color:#a78bfa">crm_push_ref</span><span class="type">str?</span></div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:0 8px">
      <div class="flow-arrow" style="color:#f59e0b;margin:0;font-size:14px">→ push to CRM →</div>
      <span style="font-size:10px;color:#8892b0">as buyer enquiry</span>
    </div>
    <div class="flow-box" style="border-color:#a78bfa44;min-width:120px"><div class="label">CRM Inbox</div><div class="name" style="color:#a78bfa;font-size:13px">Agent's CRM</div></div>
  </div>
  <div style="text-align:center;margin-top:8px;font-size:11px;color:#8892b0;font-style:italic">Buyer enquires on a live listing → enquiry sent to the listing agent(s). Standard portal model (same as REA/Domain).</div>

  <div style="text-align:center;margin-top:20px;font-size:12px;color:#8892b0">
    <span style="color:#4ade80">■</span> Green fields = populated at onboarding (RealEasy-owned, always present)<br>
    <span style="color:#f59e0b">★</span> <code>feed_code</code> = generated from <code>office_id</code> on portal activation (e.g. <code>"RE" + base36(office_id)</code>), persisted, indexed. Nullable — <code>NULL</code> = portal not activated. This is the <code>agentID</code> in inbound REAXML feeds. Together with <code>reaxml_unique_id</code> forms the composite listing key.<br>
    <span style="color:#a78bfa">■</span> Purple fields = populated when CRM API integration is active (optional enrichment)<br>
    <code style="color:#4ade80">Listing.source</code> = <code>manual</code> | <code>reaxml</code> | <code>api</code> — tracks how the listing entered the system
  </div>
</div>

</div>

</div><!-- /container -->

<script>
// Tab switching
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    if (tab.dataset.tab === 'evidence' && !window._graphDrawn) drawGraph();
  });
});

// Belle Property overlap data
const belleAgents = [
  {name:'Matthew Smythe', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Mark Jackson', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'David Benjafield', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Gemma Simons', role:'Sales Agent', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Jessica Stubberfield', role:'Sales Agent', offices:['Mosman','Cremorne']},
  {name:'Chris Davies', role:'Sales Agent', offices:['Neutral Bay']},
  {name:'Helen Wilson', role:'Sales Executive', offices:['Neutral Bay']},
  {name:'Megan Thomas', role:'Sales Agent', offices:['Mosman','Cremorne']},
  {name:'Christian', role:'Sales Agent', offices:['Neutral Bay','Wollstonecraft']},
];

const officeColors = {
  'Mosman':'#f59e0b','Neutral Bay':'#60a5fa','Crows Nest':'#a78bfa','Cammeray':'#4ade80',
  'Cremorne':'#f87171','Wollstonecraft':'#ec4899'
};

function renderOverlapList(containerId, agents) {
  const el = document.getElementById(containerId);
  el.innerHTML = agents.map(a => {
    const tags = a.offices.map(o => `<span class="office-tag" style="background:${(officeColors[o]||'#555')}22;color:${officeColors[o]||'#999'}">${o}</span>`).join('');
    const multi = a.offices.length > 1;
    return `<div class="agent-row"><span class="agent-name" style="${multi?'color:#f59e0b':'color:#4ade80'}">${a.name} <span style="color:#555c72;font-size:11px">${a.role}</span></span><div class="office-tags">${tags}</div></div>`;
  }).join('');
}

renderOverlapList('belleOverlap', belleAgents);

const rwAgents = [
  {name:'Richard Harding', role:'Director', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Geoff Smith', role:'Director', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Scott Stephens', role:'Commercial Dir.', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Tim Abbott', role:'Projects Dir.', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'+ 66 more staff', role:'All departments', offices:['Mosman','Crows Nest','Cammeray']},
];
renderOverlapList('rwOverlap', rwAgents);

const ljhAgents = [
  {name:'Jodi Price', role:'Licensee', offices:['Mountain Creek']},
  {name:'Sharnie Shaw', role:'Sales Consultant', offices:['Mountain Creek']},
  {name:'Sarah Russell', role:'Customer Relations', offices:['Mountain Creek']},
  {name:'Michael Price', role:'Principal', offices:['Mountain Creek']},
  {name:'Andrea Rogers', role:'Property Manager', offices:['Mountain Creek']},
  {name:'Lucinda Jeffery', role:'Office Admin', offices:['Mountain Creek']},
];
const ljhColors = {'Mountain Creek':'#4ade80'};
Object.assign(officeColors, ljhColors);
renderOverlapList('ljhOverlap', ljhAgents);

// Network Graph (D3 force)
function drawGraph() {
  window._graphDrawn = true;
  const container = document.querySelector('.graph-container');
  const width = container.clientWidth;
  const height = 520;
  const svg = d3.select('#networkGraph').attr('width', width).attr('height', height);
  svg.selectAll('*').remove();

  const nodes = [
    {id:'Belle Property', type:'brand', r:22},
    {id:'Mosman', type:'office', r:16},
    {id:'Neutral Bay', type:'office', r:16},
    {id:'Crows Nest', type:'office', r:16},
    {id:'Cammeray', type:'office', r:14},
    {id:'M. Smythe', type:'multi', r:10},
    {id:'M. Jackson', type:'multi', r:10},
    {id:'D. Benjafield', type:'multi', r:10},
    {id:'G. Simons', type:'multi', r:10},
    {id:'J. Stubberfield', type:'multi', r:8},
    {id:'C. Davies', type:'single', r:8},
    {id:'H. Wilson', type:'single', r:8},
    {id:'M. Thomas', type:'multi', r:8},
    {id:'Christian', type:'multi', r:8},
  ];

  const links = [
    {source:'Belle Property',target:'Mosman'},{source:'Belle Property',target:'Neutral Bay'},
    {source:'Belle Property',target:'Crows Nest'},{source:'Belle Property',target:'Cammeray'},
    // Smythe → all 4
    {source:'M. Smythe',target:'Mosman'},{source:'M. Smythe',target:'Neutral Bay'},
    {source:'M. Smythe',target:'Crows Nest'},{source:'M. Smythe',target:'Cammeray'},
    // Jackson → all 4
    {source:'M. Jackson',target:'Mosman'},{source:'M. Jackson',target:'Neutral Bay'},
    {source:'M. Jackson',target:'Crows Nest'},{source:'M. Jackson',target:'Cammeray'},
    // Benjafield → all 4
    {source:'D. Benjafield',target:'Mosman'},{source:'D. Benjafield',target:'Neutral Bay'},
    {source:'D. Benjafield',target:'Crows Nest'},{source:'D. Benjafield',target:'Cammeray'},
    // Simons → all 4
    {source:'G. Simons',target:'Mosman'},{source:'G. Simons',target:'Neutral Bay'},
    {source:'G. Simons',target:'Crows Nest'},{source:'G. Simons',target:'Cammeray'},
    // Stubberfield → Mosman
    {source:'J. Stubberfield',target:'Mosman'},
    // Davies → Neutral Bay
    {source:'C. Davies',target:'Neutral Bay'},
    // Wilson → Neutral Bay
    {source:'H. Wilson',target:'Neutral Bay'},
    // Thomas → Mosman
    {source:'M. Thomas',target:'Mosman'},
    // Christian → Neutral Bay
    {source:'Christian',target:'Neutral Bay'},
  ];

  const colorMap = {brand:'#60a5fa',office:'#a78bfa',single:'#4ade80',multi:'#f59e0b'};

  const sim = d3.forceSimulation(nodes)
    .force('link', d3.forceLink(links).id(d=>d.id).distance(d => d.source.type==='brand'?100:70).strength(0.4))
    .force('charge', d3.forceManyBody().strength(-200))
    .force('center', d3.forceCenter(width/2, height/2))
    .force('collide', d3.forceCollide().radius(d=>d.r+8));

  const defs = svg.append('defs');
  defs.append('filter').attr('id','glow')
    .append('feGaussianBlur').attr('stdDeviation','3').attr('result','blur');

  const link = svg.append('g').selectAll('line').data(links).join('line')
    .attr('stroke','#2a2f45').attr('stroke-width',1.2).attr('stroke-opacity',.6);

  const node = svg.append('g').selectAll('g').data(nodes).join('g').call(
    d3.drag().on('start',(e,d)=>{if(!e.active)sim.alphaTarget(.3).restart();d.fx=d.x;d.fy=d.y})
    .on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y}).on('end',(e,d)=>{if(!e.active)sim.alphaTarget(0);d.fx=null;d.fy=null})
  );

  node.append('circle').attr('r',d=>d.r).attr('fill',d=>colorMap[d.type]).attr('opacity',.85)
    .attr('stroke',d=>colorMap[d.type]).attr('stroke-width',2).attr('stroke-opacity',.3);

  node.append('text').text(d=>d.id).attr('dy',d=>d.r+14).attr('text-anchor','middle')
    .attr('font-size',d=>d.type==='brand'?13:11).attr('fill','#8892b0').attr('font-weight',d=>d.type==='brand'?700:400);

  sim.on('tick',()=>{
    link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
    node.attr('transform',d=>`translate(${d.x},${d.y})`);
  });
}
</script>
</body>
</html>

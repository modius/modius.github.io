---
layout: null
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Estate Agency Models — RealEasy Data Architecture</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#0f1117;color:#e0e0e0;line-height:1.6}
.header{background:linear-gradient(135deg,#1a1f36,#0d1025);padding:32px 40px;border-bottom:1px solid #2a2f45}
.header h1{font-size:24px;font-weight:700;background:linear-gradient(135deg,#60a5fa,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header p{color:#8892b0;font-size:14px;margin-top:4px}
.container{max-width:1400px;margin:0 auto;padding:24px}
.section-title{font-size:18px;font-weight:600;margin:32px 0 16px;color:#c8cee0;display:flex;align-items:center;gap:10px}
.section-title .num{background:linear-gradient(135deg,#60a5fa,#a78bfa);color:#0f1117;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0}

/* Tabs */
.tabs{display:flex;gap:4px;margin-bottom:20px;background:#1a1f36;border-radius:10px;padding:4px}
.tab{padding:10px 20px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;color:#8892b0;transition:all .2s}
.tab:hover{color:#c8cee0}
.tab.active{background:#2a2f45;color:#60a5fa}
.tab-content{display:none}
.tab-content.active{display:block}

/* Model Cards */
.model-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
@media(max-width:1000px){.model-grid{grid-template-columns:1fr}}
.model-card{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;transition:border-color .2s}
.model-card:hover{border-color:#60a5fa33}
.model-card .badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px}
.model-card h3{font-size:16px;font-weight:600;color:#e0e0e0;margin-bottom:8px}
.model-card .desc{font-size:13px;color:#8892b0;margin-bottom:16px}
.model-card .example{background:#0f1117;border-radius:8px;padding:14px;margin-bottom:12px}
.model-card .example-label{font-size:11px;color:#60a5fa;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;font-weight:600}
.model-card .example-name{font-size:14px;font-weight:600;color:#c8cee0}
.model-card .example-detail{font-size:12px;color:#8892b0;margin-top:4px}
.model-card .trait{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;font-size:13px;color:#a0a8c0}
.model-card .trait svg{width:16px;height:16px;flex-shrink:0;margin-top:2px}

/* Network Graph */
.graph-container{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;overflow:hidden;position:relative}
.graph-container svg{width:100%;display:block}
.graph-legend{position:absolute;top:16px;left:16px;background:#0f1117dd;border-radius:8px;padding:12px 16px;font-size:12px}
.graph-legend .item{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.graph-legend .item:last-child{margin-bottom:0}
.graph-legend .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.graph-title{position:absolute;top:16px;right:16px;background:#0f1117dd;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:600;color:#a78bfa}

/* Agent Overlap Table */
.overlap-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:800px){.overlap-grid{grid-template-columns:1fr}}
.overlap-card{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:20px}
.overlap-card h3{font-size:15px;font-weight:600;margin-bottom:4px}
.overlap-card .subtitle{font-size:12px;color:#8892b0;margin-bottom:14px}
.agent-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #2a2f4533;font-size:13px}
.agent-row:last-child{border-bottom:none}
.agent-name{font-weight:500;color:#c8cee0}
.office-tags{display:flex;gap:4px;flex-wrap:wrap}
.office-tag{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600;white-space:nowrap}

/* ERD */
.erd-container{background:#1a1f36;border:1px solid #2a2f45;border-radius:12px;padding:24px;overflow-x:auto}
.erd-grid{display:flex;gap:16px;align-items:flex-start;justify-content:center;flex-wrap:wrap;min-width:800px}
.erd-table{background:#0f1117;border:1px solid #2a2f45;border-radius:10px;min-width:180px;overflow:hidden}
.erd-table .table-header{background:linear-gradient(135deg,#60a5fa22,#a78bfa22);padding:10px 14px;font-size:13px;font-weight:700;color:#60a5fa;border-bottom:1px solid #2a2f45;text-align:center}
.erd-table .field{padding:6px 14px;font-size:12px;color:#a0a8c0;border-bottom:1px solid #2a2f4522;display:flex;justify-content:space-between;gap:8px}
.erd-table .field:last-child{border-bottom:none}
.erd-table .field .key{color:#e8c840;font-weight:600}
.erd-table .field .fk{color:#a78bfa;font-weight:600}
.erd-table .field .type{color:#555c72;font-size:11px}
.erd-arrow{display:flex;align-items:center;color:#2a2f45;font-size:24px;padding-top:40px}

/* Comparison Table */
.compare-table{width:100%;border-collapse:collapse;font-size:13px;background:#1a1f36;border-radius:12px;overflow:hidden}
.compare-table th{padding:12px 16px;text-align:left;background:#0f1117;color:#60a5fa;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.3px;border-bottom:1px solid #2a2f45}
.compare-table td{padding:10px 16px;border-bottom:1px solid #2a2f4544;color:#a0a8c0}
.compare-table tr:hover td{background:#2a2f4522}
.compare-table .dim{color:#555c72}
.check{color:#4ade80}
.cross{color:#f87171}

/* Impact callout */
.callout{background:linear-gradient(135deg,#60a5fa11,#a78bfa11);border:1px solid #60a5fa33;border-radius:12px;padding:20px 24px;margin:20px 0}
.callout h3{font-size:15px;font-weight:600;color:#60a5fa;margin-bottom:8px}
.callout p{font-size:13px;color:#a0a8c0}
.callout code{background:#0f1117;padding:2px 6px;border-radius:4px;font-size:12px;color:#a78bfa}

.flex-row{display:flex;gap:16px;align-items:stretch}
@media(max-width:900px){.flex-row{flex-direction:column}}
.flex-row > *{flex:1}
</style>
</head>
<body>

<div class="header">
  <h1>Real Estate Agency Models &amp; Data Architecture</h1>
  <p>Research findings for the RealEasy data model — proving the multi-office agent pattern with real-world data</p>
</div>

<div class="container">

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-tab="models">Agency Models</div>
  <div class="tab" data-tab="evidence">Evidence &amp; Overlap Data</div>
  <div class="tab" data-tab="datamodel">Proposed Data Model</div>
</div>

<!-- ======================== TAB 1: MODELS ======================== -->
<div class="tab-content active" id="tab-models">

<div class="section-title"><span class="num">1</span> Three Distinct Operating Models Observed</div>

<div class="model-grid">
  <!-- Model A -->
  <div class="model-card">
    <div class="badge" style="background:#4ade8022;color:#4ade80">Model A</div>
    <h3>Single-Office Licensee</h3>
    <div class="desc">One licensee, one physical office, agents work exclusively for that office. The simplest and most common model — what your current Group &gt; Agency &gt; Agent hierarchy assumes.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">LJ Hooker Mooloolaba | Mountain Creek</div>
      <div class="example-detail">Licensee: Jodi Price &amp; Michael Price<br>1 office · 6 staff · 69 sold listings<br>Shop 1b, Mountain Creek Shopping Centre</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Agents belong to exactly one office</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Clean 1:N relationship (office → agents)</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#4ade80"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Works with simple hierarchy</div>
  </div>

  <!-- Model B -->
  <div class="model-card">
    <div class="badge" style="background:#f59e0b22;color:#f59e0b">Model B</div>
    <h3>Multi-Office Group (Same Licensee)</h3>
    <div class="desc">One business entity operates multiple branded offices across suburbs. Agents float between offices. Appears as separate agencies externally but is one business internally.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">Belle Property (Lower North Shore)</div>
      <div class="example-detail">Principals: Smythe, Jackson &amp; Benjafield<br>4 offices · ~12 agents across all<br>Mosman · Neutral Bay · Crows Nest · Cammeray</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f59e0b"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Agents belong to MULTIPLE offices</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f59e0b"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Same ABN, same trust account</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f87171"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <strong style="color:#f87171">Breaks simple hierarchy</strong></div>
  </div>

  <!-- Model C -->
  <div class="model-card">
    <div class="badge" style="background:#a78bfa22;color:#a78bfa">Model C</div>
    <h3>Branded Group (Shared Pool)</h3>
    <div class="desc">Explicit multi-office brand with a single shared team, shared database, and pooled agent resources. Often uses a "Group" suffix. One team, many locations.</div>
    <div class="example">
      <div class="example-label">Real Example</div>
      <div class="example-name">Ray White Lower North Shore Group</div>
      <div class="example-detail">Directors: Richard Harding &amp; Geoff Smith<br>3 offices · 70 staff · shared database<br>Mosman · Crows Nest · Cammeray</div>
    </div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#a78bfa"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> "Three offices. One team. One database."</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#a78bfa"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> Agents explicitly cross-office</div>
    <div class="trait"><svg viewBox="0 0 24 24" fill="#f87171"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <strong style="color:#f87171">Breaks simple hierarchy</strong></div>
  </div>
</div>

<div class="callout" style="margin-top:20px">
  <h3>Key Insight</h3>
  <p>Models B and C are functionally identical — the only difference is transparency. Belle Property presents four "separate" agencies to the public while operating as one. Ray White LNS is upfront about being "one group." Both require the same data model: <code>Agent ↔ Office</code> must be <strong>many-to-many</strong>, not one-to-many.</p>
</div>

<div class="section-title" style="margin-top:28px"><span class="num">2</span> Side-by-Side Model Comparison</div>

<div style="border-radius:12px;overflow:hidden;border:1px solid #2a2f45">
<table class="compare-table">
<thead>
<tr><th>Attribute</th><th style="color:#4ade80">Model A — Single Office</th><th style="color:#f59e0b">Model B — Multi-Office (Hidden)</th><th style="color:#a78bfa">Model C — Branded Group</th></tr>
</thead>
<tbody>
<tr><td>Example</td><td>LJ Hooker Mooloolaba</td><td>Belle Property LNS</td><td>Ray White LNS Group</td></tr>
<tr><td>Offices</td><td>1</td><td>4 (appear separate)</td><td>3 (branded as group)</td></tr>
<tr><td>Team size</td><td>6</td><td>~12</td><td>70</td></tr>
<tr><td>Licensees/Principals</td><td>Jodi &amp; Michael Price</td><td>Smythe, Jackson, Benjafield</td><td>Harding &amp; Smith</td></tr>
<tr><td>Agent floats across offices?</td><td class="cross">✗ No</td><td class="check">✓ Yes (undisclosed)</td><td class="check">✓ Yes (explicit)</td></tr>
<tr><td>Shared database?</td><td class="dim">N/A (one office)</td><td class="check">✓ Yes</td><td class="check">✓ Yes (stated)</td></tr>
<tr><td>Shared Instagram?</td><td class="dim">Single brand</td><td class="check">✓ @belleneutralbay&hellip;</td><td class="check">✓ @raywhitelnsgroup</td></tr>
<tr><td>Rate My Agent listing</td><td>Single office</td><td>Combined: "NB, Mosman, CN &amp; Cammeray"</td><td>Single group</td></tr>
<tr><td>Public perception</td><td>One agency</td><td>Four agencies</td><td>One group, 3 locations</td></tr>
<tr><td>Data model impact</td><td class="check">✓ Simple 1:N</td><td class="cross">✗ Requires M:N</td><td class="cross">✗ Requires M:N</td></tr>
</tbody>
</table>
</div>

</div>

<!-- ======================== TAB 2: EVIDENCE ======================== -->
<div class="tab-content" id="tab-evidence">

<div class="section-title"><span class="num">1</span> Agent-to-Office Relationships — Network Visualisation</div>

<div class="graph-container" style="height:520px">
  <svg id="networkGraph"></svg>
  <div class="graph-legend">
    <div class="item"><div class="dot" style="background:#60a5fa"></div> Brand / Group</div>
    <div class="item"><div class="dot" style="background:#a78bfa"></div> Office</div>
    <div class="item"><div class="dot" style="background:#4ade80"></div> Agent (single office)</div>
    <div class="item"><div class="dot" style="background:#f59e0b"></div> Agent (multi-office)</div>
  </div>
  <div class="graph-title">Belle Property Lower North Shore</div>
</div>

<div class="section-title"><span class="num">2</span> Confirmed Agent Overlaps</div>

<div class="overlap-grid">
  <div class="overlap-card">
    <h3>Belle Property — Agent × Office Matrix</h3>
    <div class="subtitle">Principals listed across all 4 offices; agents float between them</div>
    <div id="belleOverlap"></div>
  </div>
  <div class="overlap-card">
    <h3>Ray White LNS — Agent Pool Model</h3>
    <div class="subtitle">"Three offices. One team. One Database." — 70 staff shared</div>
    <div id="rwOverlap"></div>
  </div>
</div>

<div class="section-title"><span class="num">3</span> LJ Hooker (Control) — No Overlap</div>

<div class="overlap-card" style="max-width:600px">
  <h3>LJ Hooker Mooloolaba | Mountain Creek</h3>
  <div class="subtitle">All 6 agents belong exclusively to the single office</div>
  <div id="ljhOverlap"></div>
</div>

</div>

<!-- ======================== TAB 3: DATA MODEL ======================== -->
<div class="tab-content" id="tab-datamodel">

<div class="section-title"><span class="num">1</span> Current Model (Breaks on Model B &amp; C)</div>

<div class="callout" style="border-color:#f8717133;background:#f8717108">
  <h3 style="color:#f87171">Problem</h3>
  <p>The current <code>Group → Agency → Agent</code> model assumes an agent belongs to exactly one agency. This fails when the same agent (e.g. Matthew Smythe) appears under Belle Property Mosman, Neutral Bay, Crows Nest, AND Cammeray — or when Ray White's 70 staff operate as one pool across 3 offices.</p>
</div>

<div class="erd-container" style="margin-bottom:24px">
  <div style="text-align:center;margin-bottom:16px;color:#f87171;font-weight:600;font-size:14px">❌ Current (Broken) Model</div>
  <div class="erd-grid">
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Group</div>
      <div class="field"><span><span class="key">PK</span> group_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">→</div>
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Agency</div>
      <div class="field"><span><span class="key">PK</span> agency_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> group_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">→</div>
    <div class="erd-table">
      <div class="table-header" style="background:linear-gradient(135deg,#f8717122,#f8717122);color:#f87171">Agent</div>
      <div class="field"><span><span class="key">PK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> agency_id</span><span class="type">int ⚠️</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:12px;font-size:12px;color:#f87171">⚠️ Agent.agency_id forces a single agency — cannot represent multi-office agents</div>
</div>

<div class="section-title"><span class="num">2</span> Proposed Model (Handles All Three Patterns)</div>

<div class="callout">
  <h3>Solution</h3>
  <p>Introduce a <code>BusinessEntity</code> (the licensee/principal) between Brand and Office, and replace the direct <code>Agent → Office</code> FK with a junction table <code>AgentOffice</code>. This supports agents belonging to one OR many offices, while preserving the business ownership hierarchy.</p>
</div>

<div class="erd-container">
  <div style="text-align:center;margin-bottom:16px;color:#4ade80;font-weight:600;font-size:14px">✓ Proposed Model</div>
  <div class="erd-grid">
    <div class="erd-table">
      <div class="table-header">Brand</div>
      <div class="field"><span><span class="key">PK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>website</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table">
      <div class="table-header">BusinessEntity</div>
      <div class="field"><span><span class="key">PK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> brand_id</span><span class="type">int</span></div>
      <div class="field"><span>abn</span><span class="type">str</span></div>
      <div class="field"><span>licence_no</span><span class="type">str</span></div>
      <div class="field"><span>trust_account</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">1:N →</div>
    <div class="erd-table">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> entity_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>suburb</span><span class="type">str</span></div>
      <div class="field"><span>address</span><span class="type">str</span></div>
      <div class="field"><span>phone</span><span class="type">str</span></div>
    </div>
  </div>
  <div style="display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap">
    <div class="erd-table">
      <div class="table-header">Agent</div>
      <div class="field"><span><span class="key">PK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span>name</span><span class="type">str</span></div>
      <div class="field"><span>phone</span><span class="type">str</span></div>
      <div class="field"><span>email</span><span class="type">str</span></div>
      <div class="field"><span>licence_no</span><span class="type">str</span></div>
    </div>
    <div class="erd-arrow">M:N ↔</div>
    <div class="erd-table" style="border-color:#a78bfa44">
      <div class="table-header" style="background:linear-gradient(135deg,#a78bfa22,#60a5fa22)">AgentOffice ★</div>
      <div class="field"><span><span class="fk">FK</span> agent_id</span><span class="type">int</span></div>
      <div class="field"><span><span class="fk">FK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span>role</span><span class="type">str</span></div>
      <div class="field"><span>is_primary</span><span class="type">bool</span></div>
      <div class="field"><span>start_date</span><span class="type">date</span></div>
      <div class="field"><span>end_date</span><span class="type">date?</span></div>
    </div>
    <div class="erd-arrow">↔ N:1</div>
    <div class="erd-table">
      <div class="table-header">Office</div>
      <div class="field"><span><span class="key">PK</span> office_id</span><span class="type">int</span></div>
      <div class="field"><span>(see above)</span><span class="type"></span></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:16px;font-size:12px;color:#4ade80">★ Junction table allows agents to belong to 1 or more offices with role context</div>
</div>

<div class="section-title"><span class="num">3</span> How Each Model Maps</div>

<div style="border-radius:12px;overflow:hidden;border:1px solid #2a2f45">
<table class="compare-table">
<thead><tr><th>Scenario</th><th>Brand</th><th>BusinessEntity</th><th>Offices</th><th>AgentOffice rows</th></tr></thead>
<tbody>
<tr>
  <td style="color:#4ade80">LJ Hooker MMC<br><span class="dim">Model A</span></td>
  <td>LJ Hooker</td>
  <td>1 (Price family)</td>
  <td>1 (Mtn Creek)</td>
  <td>6 rows (1 per agent × 1 office)</td>
</tr>
<tr>
  <td style="color:#f59e0b">Belle Property LNS<br><span class="dim">Model B</span></td>
  <td>Belle Property</td>
  <td>1 (Smythe/Jackson/Benjafield)</td>
  <td>4 (Mosman, NB, CN, Cammeray)</td>
  <td>~36 rows (agents × offices they serve)</td>
</tr>
<tr>
  <td style="color:#a78bfa">Ray White LNS<br><span class="dim">Model C</span></td>
  <td>Ray White</td>
  <td>1 (Harding &amp; Smith)</td>
  <td>3 (Mosman, CN, Cammeray)</td>
  <td>~210 rows (70 staff × 3 offices)</td>
</tr>
</tbody>
</table>
</div>

<div class="callout" style="margin-top:20px">
  <h3>Additional Fields to Consider</h3>
  <p><code>AgentOffice.role</code> — captures whether someone is "Principal", "Sales Agent", "Property Manager" etc. at each specific office.<br>
  <code>AgentOffice.is_primary</code> — flags the agent's "home" office for display/default purposes.<br>
  <code>AgentOffice.start_date / end_date</code> — handles agent movement between offices over time (historically important for sold listing attribution).<br>
  <code>BusinessEntity.abn</code> — the real identifier that ties offices together, even when branding hides the relationship.</p>
</div>

</div>

</div><!-- /container -->

<script>
// Tab switching
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    if (tab.dataset.tab === 'evidence' && !window._graphDrawn) drawGraph();
  });
});

// Belle Property overlap data
const belleAgents = [
  {name:'Matthew Smythe', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Mark Jackson', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'David Benjafield', role:'Principal', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Gemma Simons', role:'Sales Agent', offices:['Mosman','Neutral Bay','Crows Nest','Cammeray']},
  {name:'Jessica Stubberfield', role:'Sales Agent', offices:['Mosman','Cremorne']},
  {name:'Chris Davies', role:'Sales Agent', offices:['Neutral Bay']},
  {name:'Helen Wilson', role:'Sales Executive', offices:['Neutral Bay']},
  {name:'Megan Thomas', role:'Sales Agent', offices:['Mosman','Cremorne']},
  {name:'Christian', role:'Sales Agent', offices:['Neutral Bay','Wollstonecraft']},
];

const officeColors = {
  'Mosman':'#f59e0b','Neutral Bay':'#60a5fa','Crows Nest':'#a78bfa','Cammeray':'#4ade80',
  'Cremorne':'#f87171','Wollstonecraft':'#ec4899'
};

function renderOverlapList(containerId, agents) {
  const el = document.getElementById(containerId);
  el.innerHTML = agents.map(a => {
    const tags = a.offices.map(o => `<span class="office-tag" style="background:${(officeColors[o]||'#555')}22;color:${officeColors[o]||'#999'}">${o}</span>`).join('');
    const multi = a.offices.length > 1;
    return `<div class="agent-row"><span class="agent-name" style="${multi?'color:#f59e0b':'color:#4ade80'}">${a.name} <span style="color:#555c72;font-size:11px">${a.role}</span></span><div class="office-tags">${tags}</div></div>`;
  }).join('');
}

renderOverlapList('belleOverlap', belleAgents);

const rwAgents = [
  {name:'Richard Harding', role:'Director', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Geoff Smith', role:'Director', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Scott Stephens', role:'Commercial Dir.', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'Tim Abbott', role:'Projects Dir.', offices:['Mosman','Crows Nest','Cammeray']},
  {name:'+ 66 more staff', role:'All departments', offices:['Mosman','Crows Nest','Cammeray']},
];
renderOverlapList('rwOverlap', rwAgents);

const ljhAgents = [
  {name:'Jodi Price', role:'Licensee', offices:['Mountain Creek']},
  {name:'Sharnie Shaw', role:'Sales Consultant', offices:['Mountain Creek']},
  {name:'Sarah Russell', role:'Customer Relations', offices:['Mountain Creek']},
  {name:'Michael Price', role:'Principal', offices:['Mountain Creek']},
  {name:'Andrea Rogers', role:'Property Manager', offices:['Mountain Creek']},
  {name:'Lucinda Jeffery', role:'Office Admin', offices:['Mountain Creek']},
];
const ljhColors = {'Mountain Creek':'#4ade80'};
Object.assign(officeColors, ljhColors);
renderOverlapList('ljhOverlap', ljhAgents);

// Network Graph (D3 force)
function drawGraph() {
  window._graphDrawn = true;
  const container = document.querySelector('.graph-container');
  const width = container.clientWidth;
  const height = 520;
  const svg = d3.select('#networkGraph').attr('width', width).attr('height', height);
  svg.selectAll('*').remove();

  const nodes = [
    {id:'Belle Property', type:'brand', r:22},
    {id:'Mosman', type:'office', r:16},
    {id:'Neutral Bay', type:'office', r:16},
    {id:'Crows Nest', type:'office', r:16},
    {id:'Cammeray', type:'office', r:14},
    {id:'M. Smythe', type:'multi', r:10},
    {id:'M. Jackson', type:'multi', r:10},
    {id:'D. Benjafield', type:'multi', r:10},
    {id:'G. Simons', type:'multi', r:10},
    {id:'J. Stubberfield', type:'multi', r:8},
    {id:'C. Davies', type:'single', r:8},
    {id:'H. Wilson', type:'single', r:8},
    {id:'M. Thomas', type:'multi', r:8},
    {id:'Christian', type:'multi', r:8},
  ];

  const links = [
    {source:'Belle Property',target:'Mosman'},{source:'Belle Property',target:'Neutral Bay'},
    {source:'Belle Property',target:'Crows Nest'},{source:'Belle Property',target:'Cammeray'},
    // Smythe → all 4
    {source:'M. Smythe',target:'Mosman'},{source:'M. Smythe',target:'Neutral Bay'},
    {source:'M. Smythe',target:'Crows Nest'},{source:'M. Smythe',target:'Cammeray'},
    // Jackson → all 4
    {source:'M. Jackson',target:'Mosman'},{source:'M. Jackson',target:'Neutral Bay'},
    {source:'M. Jackson',target:'Crows Nest'},{source:'M. Jackson',target:'Cammeray'},
    // Benjafield → all 4
    {source:'D. Benjafield',target:'Mosman'},{source:'D. Benjafield',target:'Neutral Bay'},
    {source:'D. Benjafield',target:'Crows Nest'},{source:'D. Benjafield',target:'Cammeray'},
    // Simons → all 4
    {source:'G. Simons',target:'Mosman'},{source:'G. Simons',target:'Neutral Bay'},
    {source:'G. Simons',target:'Crows Nest'},{source:'G. Simons',target:'Cammeray'},
    // Stubberfield → Mosman
    {source:'J. Stubberfield',target:'Mosman'},
    // Davies → Neutral Bay
    {source:'C. Davies',target:'Neutral Bay'},
    // Wilson → Neutral Bay
    {source:'H. Wilson',target:'Neutral Bay'},
    // Thomas → Mosman
    {source:'M. Thomas',target:'Mosman'},
    // Christian → Neutral Bay
    {source:'Christian',target:'Neutral Bay'},
  ];

  const colorMap = {brand:'#60a5fa',office:'#a78bfa',single:'#4ade80',multi:'#f59e0b'};

  const sim = d3.forceSimulation(nodes)
    .force('link', d3.forceLink(links).id(d=>d.id).distance(d => d.source.type==='brand'?100:70).strength(0.4))
    .force('charge', d3.forceManyBody().strength(-200))
    .force('center', d3.forceCenter(width/2, height/2))
    .force('collide', d3.forceCollide().radius(d=>d.r+8));

  const defs = svg.append('defs');
  defs.append('filter').attr('id','glow')
    .append('feGaussianBlur').attr('stdDeviation','3').attr('result','blur');

  const link = svg.append('g').selectAll('line').data(links).join('line')
    .attr('stroke','#2a2f45').attr('stroke-width',1.2).attr('stroke-opacity',.6);

  const node = svg.append('g').selectAll('g').data(nodes).join('g').call(
    d3.drag().on('start',(e,d)=>{if(!e.active)sim.alphaTarget(.3).restart();d.fx=d.x;d.fy=d.y})
    .on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y}).on('end',(e,d)=>{if(!e.active)sim.alphaTarget(0);d.fx=null;d.fy=null})
  );

  node.append('circle').attr('r',d=>d.r).attr('fill',d=>colorMap[d.type]).attr('opacity',.85)
    .attr('stroke',d=>colorMap[d.type]).attr('stroke-width',2).attr('stroke-opacity',.3);

  node.append('text').text(d=>d.id).attr('dy',d=>d.r+14).attr('text-anchor','middle')
    .attr('font-size',d=>d.type==='brand'?13:11).attr('fill','#8892b0').attr('font-weight',d=>d.type==='brand'?700:400);

  sim.on('tick',()=>{
    link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
    node.attr('transform',d=>`translate(${d.x},${d.y})`);
  });
}
</script>
</body>
</html>
